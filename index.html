<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>AJAX Sample</title>
</head>
<body>
	<h1>AJAX Sample</h1>
	<p>With Get</p>
	<button type="button" onclick="ajaxCallTextFile('ajax_info.txt','ajax-result')">Change Content From Text File</button>

	<button type="button" onclick="ajaxCallJsonFile('sample.json','ajax-result')">Change Content From Json File</button>

	<button type="button" onclick="ajaxCallPHPFile('getAdminUserNameData.php','ajax-result')">Change Content From PHP File</button>

	<div id="ajax-result">
	  
	</div>

	<script>
		// 200: "OK"
		// 403: "Forbidden"
		// 404: "Page not found"

		function ajaxCallTextFile(file,div){
			let ajaxRequest = new XMLHttpRequest();
			let responseDiv = document.getElementById(div);

			ajaxRequest.onreadystatechange = function(){
				if(this.readyState == 4 && this.status == 200){
					responseDiv.innerHTML = this.responseText;
				}else if(this.status == 404){
					responseDiv.innerHTML = "There was an error: The file is not found";
				}else if(this.status == 403){
					responseDiv.innerHTML = "There was an error: The file is set to forbidden";
				}
				console.log(this.responseText);

			};

			ajaxRequest.open("GET","file-samples/ajax_info.txt",true);
			ajaxRequest.send();
		}

		function ajaxCallJsonFile(file,div){
			let ajaxRequest = new XMLHttpRequest();
			let responseDiv = document.getElementById(div);

			ajaxRequest.onreadystatechange = function(){
				if(this.readyState == 4 && this.status == 200){
					let ajaxResponse = JSON.parse(this.responseText);
					let output = "";
					    output += "<ul>";
					    output += "<li>"+ajaxResponse.name+"</li>";
					    output += "<li>"+ajaxResponse.age+"</li>";
					    output += "<li>"+ajaxResponse.city+"</li>";
				    	output += "</ul>";

					responseDiv.innerHTML = output;
				}else if(this.status == 404){
					responseDiv.innerHTML = "There was an error: The file is not found";
				}else if(this.status == 403){
					responseDiv.innerHTML = "There was an error: The file is set to forbidden";
				}

			};

			ajaxRequest.open("GET","file-samples/sample.json",true);
			ajaxRequest.send();
		}

		function ajaxCallPHPFile(file,div){
			let ajaxRequest = new XMLHttpRequest();
			let responseDiv = document.getElementById(div);

			ajaxRequest.onreadystatechange = function(){
				if(this.readyState == 4 && this.status == 200){
					let ajaxResponse = this.responseText;
					let output = "";
					    output += "<ul>";
					    output += "<li>"+ajaxResponse.name+"</li>";
					    output += "<li>"+ajaxResponse.age+"</li>";
					    output += "<li>"+ajaxResponse.city+"</li>";
				    	output += "</ul>";

					responseDiv.innerHTML = ajaxResponse;
				}else if(this.status == 404){
					responseDiv.innerHTML = "There was an error: The file is not found";
				}else if(this.status == 403){
					responseDiv.innerHTML = "There was an error: The file is set to forbidden";
				}

			};

			ajaxRequest.open("GET","file-samples/getAdminUserNameData.php",true);
			ajaxRequest.send();
		}
		
	</script>

	<h1>Ajax Form Using Get Method</h1>
	<p>Not Safe</p>
	<form id="get-form">
		<input type="text" name="name" id="user_name">
		<button>Submit</button>
	</form>

	<script type="text/javascript">
		document.getElementById('get-form').addEventListener("submit", getName);


		function getName(e){
			e.preventDefault();
			var name = document.getElementById("user_name").value;
			var xhr = new XMLHttpRequest();
			xhr.open('GET','file-samples/process.php?name='+name, true);
			// xhr.open('GET','file-samples/process.php?name=Jason', true);

			xhr.onload = function(){
				console.log(this.responseText);
			}

			xhr.send();

			
		}
	</script>

	<h1>Ajax Form Using Post Method</h1>
	<p>Safe and prefered</p>
	<form id="post-form">
		<input type="text" name="name" id="post_name">
		<button>Submit</button>
	</form>

	<script type="text/javascript">
		document.getElementById('post-form').addEventListener("submit", postName);


		function postName(e){
			e.preventDefault();

			var name = document.getElementById("post_name").value;
			//console.log(name);
			var params ="name="+name;
			//var params = "name=tom";
			var xhr = new XMLHttpRequest();
			xhr.open('POST','file-samples/process.php', true);
			xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");
		
			xhr.onload = function(){
				console.log(this.responseText);
			}

			xhr.send(params);
	
		}
	</script>
<br>
<h2>Ajax Fetch php mysql</h2>
<button id="load-users-btn">load Users</button>

<div id="users"></div>

<script>
	document.getElementById("load-users-btn").addEventListener('click', loadUsers);

	function loadUsers(){
			let ajaxRequest = new XMLHttpRequest();
			let responseDiv = document.getElementById("users");

			ajaxRequest.onreadystatechange = function(){
				if(this.readyState == 4 && this.status == 200){
					let users = JSON.parse(this.responseText);
					let output = "";

					    output += "<ul>";
					    for(var i in users){
					    	output += "<li>"+users[i].ID+"</li>";
					    	output += "<li>"+users[i].name+"</li>";
					    }
					   
				    	output += "</ul>";

					responseDiv.innerHTML = output;
				}else if(this.status == 404){
					responseDiv.innerHTML = "There was an error: The file is not found";
				}else if(this.status == 403){
					responseDiv.innerHTML = "There was an error: The file is set to forbidden";
				}

			};

			ajaxRequest.open("GET","file-samples/users.php",true);
			ajaxRequest.send();
		}
</script>


</body>
</html>